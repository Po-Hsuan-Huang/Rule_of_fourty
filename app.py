import dash
from dash import html, dcc, Input, Output, State
import plotly.graph_objs as go

# Initial data
initial_data = [
    ("Visa (V)",            66.77,   11.38,   570.0),
    ("TSMC (TSM)",          49.63,   38.60,   710.0),
    ("Broadcom (AVGO)",     31.76,   16.40,   660.0),
    ("Palantir (PLTR)",     26.83,   48.00,    65.0),
    ("Quad (QUAD)",          3.95,   -9.80,     0.22),
    ("Supermicro (SMCI)",    5.30,   47.00,    78.0),
    ("Axon (AXON)",          0.70,   33.00,    24.0),
    ("MercadoLibre (MELI)", 12.20,   34.00,    92.0),
    ("Credo (CRDO)",        20.39,  126.34,    18.93),
    ("Rocket Lab (RKLB)",  -43.11,   32.00,    21.45),
    ("Spotify (SPOT)",       9.68,   21.00,   133.0),
    ("Microsoft (MSFT)",    44.90,   18.00,  3966.0),
    ("Tencent (TCEHY)",     31.87,   12.90,   645.57),
    ("Joby Aviation (JOBY)", -5532.8, -9470.0, 14.86),
    ("Cloudflare (NET)",    -9.27,   27.80,    72.42),
    ("NVidia (NVDA)", 69.2 , 49.11,4340),     #4.3T


]

slope = -41 / 39  # â‰ˆ -1.051
avg_intercept = sum(y - slope * x for _, x, y, z in initial_data) / len(initial_data)

# Create Dash app
app = dash.Dash(__name__)
server = app.server  # For deployment if needed
rule_header = html.Div([
        html.H4("ðŸ“˜ Rule of 40 / 40æ³•å‰‡"),

        html.P(
            "The Rule of 40 is a metric for evaluating a company's financial health. "
            "If the intercept of Revenue Growth is greater than 40, "
            "the company is considered financially strong."
        ),
        html.P(
            "40æ³•å‰‡è¡¡é‡ä¸€å®¶å…¬å¸çš„æˆé•·æ½›åŠ›èˆ‡è²¡å‹™éŸŒæ€§ã€‚"
            "ä»»ä½• y è»¸æˆªè·é«˜æ–¼ 40 çš„å…¬å¸ï¼Œé€šå¸¸åŒæ™‚å…·å‚™å¼·å‹çš„ç‡Ÿæ”¶å¢žé•·èˆ‡å¥åº·çš„ç²åˆ©èƒ½åŠ›ï¼Œ"
            "å› æ­¤è¢«è¦–ç‚ºå€¼å¾—é•·æœŸæŠ•è³‡çš„æ¨™çš„ã€‚"
            "è¼¸å…¥æ‚¨æƒ³è¦æ¯”è¼ƒçš„å…¬å¸ä»£ç¢¼åŠæŒ‡æ¨™ï¼Œæˆ‘å€‘æœƒè¨ˆç®—è©²å…¬å¸çš„ 40 æ³•å‰‡ï¼Œ"
            "å¹«åŠ©æ‚¨åˆ¤æ–·å…¶åœ¨å¸‚å ´ä¸­çš„ç«¶çˆ­åœ°ä½ã€‚"
        ),
    ], style={"margin-bottom": "2em"})


def chapter1_content():
    return [
        html.H4("ðŸ“– ç¬¬1ç« ï¼šå¾Œç¨€ç¼ºæ™‚ä»£çš„é»Žæ˜Ž"),
        html.P("å°Žè«–ï¼šç¶“æ¿Ÿæ–°æ›™å…‰"),
        html.P(
            "æ•¸ç™¾å¹´ä¾†ï¼Œç¶“æ¿Ÿå­¸çš„æ ¸å¿ƒå•é¡Œä¸€ç›´åœç¹žè‘—ã€Œç¨€ç¼ºæ€§ã€â€”â€”å¦‚ä½•åœ¨æœ‰é™è³‡æºèˆ‡ç„¡é™éœ€æ±‚ä¹‹é–“åšå‡ºé¸æ“‡ã€‚"
            "åœŸåœ°ã€å‹žå‹•èˆ‡è³‡æœ¬ä¸‰å¤§ç”Ÿç”¢è¦ç´ ï¼Œå¡‘é€ äº†äººé¡žæ–‡æ˜Žçš„æ¯ä¸€æ¬¡ç¶“æ¿Ÿé£›èºã€‚"
            "å…¶ä¸­ï¼Œå‹žå‹•åŠ›çš„ç¨€ç¼ºæ€§å°¤å…¶é—œéµï¼šäººé¡žçš„æ™‚é–“æœ‰é™ã€é«”åŠ›æœ‰é™ã€èªçŸ¥èƒ½åŠ›æœ‰é™ï¼Œ"
            "å› æ­¤æ¯ä¸€æ¬¡æŠ€è¡“é©å‘½â€”â€”å¾žè¾²æ¥­å·¥å…·çš„æ”¹é€²ã€è’¸æ±½æ©Ÿçš„èª•ç”Ÿï¼Œåˆ°é›»è…¦çš„æ™®åŠâ€”â€”"
            "éƒ½æ—¨åœ¨è®“åŒæ¨£çš„å‹žå‹•åŠ›å‰µé€ æ›´å¤šçš„åƒ¹å€¼ã€‚"
            "ç„¶è€Œï¼Œç•¶é€™ç¨®æ ¹æœ¬é™åˆ¶æ¶ˆå¤±æ™‚ï¼Œæˆ‘å€‘å°‡é¢å°ä¸€å€‹å‰æ‰€æœªæœ‰çš„ä¸–ç•Œã€‚"
        ),
        html.P(
            "æœ¬ç« ä»¥ä¸€å€‹éœ‡æ’¼çš„å‡è¨­ç‚ºèµ·é»žï¼šäººé¡žæ­£ç«™åœ¨æ­·å²ä¸Šæœ€æ·±åˆ»çš„ç¶“æ¿Ÿè½‰åž‹é–€æª»å‰â€”â€”"
            "é€šç”¨äººå·¥æ™ºæ…§ï¼ˆAGIï¼‰çš„å‡ºç¾ã€‚"
            "ç•¶ AGI èƒ½ä»¥å¯æ¯”æ“¬ç”šè‡³è¶…è¶Šäººé¡žçš„æ–¹å¼ï¼ŒåŸ·è¡Œå¹¾ä¹Žä»»ä½•èªçŸ¥èˆ‡å‰µé€ æ€§ä»»å‹™æ™‚ï¼Œ"
            "å‹žå‹•åŠ›å°‡ä¸å†æ˜¯ç¨€ç¼ºè³‡æºï¼Œç”Ÿç”¢æˆæœ¬çš„é‚è¼¯å°‡å¾¹åº•é¡›è¦†ã€‚"
        ),

        html.H5("èˆŠä¸–ç•Œï¼šç¨€ç¼ºã€å‹žå‹•èˆ‡åƒ¹å€¼"),
        html.P(
            "å‚³çµ±ç¶“æ¿Ÿçš„é‚è¼¯å¯ä»¥ç”¨ä¸‰å€‹æ ¸å¿ƒæ¦‚å¿µä¾†ç†è§£ï¼š"
        ),
        html.Ul([
            html.Li("è³‡æºï¼ˆResourcesï¼‰ï¼šåœŸåœ°ã€å‹žå‹•ã€è³‡æœ¬æ˜¯ç”Ÿç”¢çš„åŸºç¤Žã€‚å°æ–¼å¤§å¤šæ•¸æ™‚æœŸçš„äººé¡žç¤¾æœƒï¼Œå‹žå‹•åŠ›æ˜¯æœ€ç¨€ç¼ºä¸”æœ€æ˜‚è²´çš„è³‡æºã€‚"),
            html.Li("ç”Ÿç”¢åŠ›ï¼ˆProductivityï¼‰ï¼šè¡¡é‡è³‡æºè½‰åŒ–ç‚ºç”¢å“æˆ–æœå‹™çš„æ•ˆçŽ‡ã€‚æ­·å²ä¸Šï¼Œç”Ÿç”¢åŠ›çš„æå‡å¹¾ä¹Žç¸½æ˜¯é€éŽè¼”åŠ©å·¥å…·èˆ‡æŠ€è¡“ä¾†æ”¾å¤§å‹žå‹•åŠ›çš„ç”¢å‡ºã€‚"),
            html.Li("åƒ¹å€¼ï¼ˆValueï¼‰ï¼šåƒ¹å€¼çš„å½¢æˆèˆ‡æŠ•å…¥çš„å‹žå‹•æˆæœ¬å¯†åˆ‡ç›¸é—œï¼Œå¾žè¨­è¨ˆè€…ã€å·¥åŒ ï¼Œåˆ°é‹è¼¸èˆ‡éŠ·å”®çš„æ¯ä¸€ç’°ç¯€ï¼Œéƒ½è˜Šå«è‘—äººåŠ›æˆæœ¬ã€‚")
        ]),
        html.P(
            "æƒ³åƒå»ºé€ ä¸€æ£Ÿæˆ¿å­ï¼šåœŸåœ°èˆ‡ææ–™å›ºç„¶é‡è¦ï¼Œä½†æœ€å¤§çš„æˆæœ¬ä¾†è‡ªæ–¼äººåŠ›â€”â€”å»ºç¯‰å¸«çš„è¨­è¨ˆã€æœ¨å·¥èˆ‡æ°´é›»å·¥çš„æ–½å·¥ã€å·¥ç¨‹ç›£ç†çš„ç®¡ç†ã€‚"
            "ä½†è‹¥é€™äº›è§’è‰²å…¨ç”± AGI ä»¥é›¶ç–²å‹žã€é›¶ä¼‘æ¯çš„æ–¹å¼å®Œæˆï¼Œä¸”åƒ…éœ€æ”¯ä»˜è¨ˆç®—èˆ‡èƒ½æºæˆæœ¬ï¼Œé‚£éº¼åƒ¹å€¼çš„è¡¡é‡æ–¹å¼å°‡å¾¹åº•æ”¹è®Šã€‚"
        ),

        html.H5("AGI é©å‘½ï¼šç•¶å‹žå‹•è®Šå¾—å……è£•"),
        html.P(
            "ä»Šå¤©çš„äººå·¥æ™ºæ…§ï¼ˆçª„ AIï¼‰å·²èƒ½åœ¨ç‰¹å®šé ˜åŸŸè¶…è¶Šäººé¡žï¼Œä¾‹å¦‚åœæ£‹å°å¼ˆã€èªžéŸ³è­˜åˆ¥ã€å½±åƒåˆ†é¡žã€‚"
            "ç„¶è€Œ AGI çš„ç›®æ¨™ä¸¦éžå–®é»žçªç ´ï¼Œè€Œæ˜¯å…·å‚™èˆ‡äººé¡žç›¸ä¼¼çš„é€šç”¨èªçŸ¥èˆ‡å­¸ç¿’èƒ½åŠ›ï¼Œ"
            "èƒ½å¤ è·¨é ˜åŸŸæ•´åˆçŸ¥è­˜ã€ç†è§£è¤‡é›œå•é¡Œã€åšå‡ºç­–ç•¥æ±ºç­–ï¼Œç”šè‡³å‰µé€ æ–°çŸ¥ã€‚"
        ),
        html.P(
            "é€™æ„å‘³è‘—ï¼ŒAGI å°‡ä¸åƒ…å–ä»£é‡è¤‡æ€§å‹žå‹•ï¼Œé‚„å°‡æ·±å…¥ç§‘å­¸ç ”ç©¶ã€ç”¢å“è¨­è¨ˆã€æ–‡åŒ–å‰µä½œèˆ‡æ”¿ç­–è¦åŠƒç­‰é«˜åº¦æ™ºåŠ›å¯†é›†çš„é ˜åŸŸã€‚"
            "ä¸€æ—¦å‹žå‹•åŠ›è®Šå¾—ã€Œå¯ç„¡é™è¤‡è£½ä¸”å¹¾ä¹Žå…è²»ã€ï¼Œå‚³çµ±ç¶“æ¿Ÿä¸­æœ€æ ¸å¿ƒçš„ç¨€ç¼ºæ€§å°‡çž¬é–“æ¶ˆå¤±ã€‚"
        ),

        html.H5("æ–°ç¶“æ¿Ÿå­¸ï¼šè·¨è¶Šå‹žå‹•éšœç¤™"),
        html.P(
            "ç•¶å‹žå‹•åŠ›æˆæœ¬ä¸å†æ§‹æˆç”Ÿç”¢ç“¶é ¸æ™‚ï¼Œæ–°çš„ç¨€ç¼ºæ€§å°‡è½‰ç§»åˆ°å…¶ä»–é ˜åŸŸï¼š"
        ),
        html.Ul([
            html.Li("èƒ½æºï¼ˆEnergyï¼‰ï¼šç‚ºå…¨çƒ AGI èˆ‡è‡ªå‹•åŒ–ç³»çµ±ä¾›é›»éœ€è¦å·¨å¤§ä¸”ç©©å®šçš„èƒ½æºè¼¸å…¥ï¼Œèƒ½æºçš„æˆæœ¬èˆ‡æ¸…æ½”åº¦å°‡æ±ºå®šç¶“æ¿Ÿç«¶çˆ­åŠ›ã€‚"),
            html.Li("åŽŸææ–™ï¼ˆRaw Materialsï¼‰ï¼šå†å¼·å¤§çš„æ™ºæ…§ç³»çµ±ä¹Ÿéœ€è¦ç‰©è³ªåŸºç¤Žï¼Œå¦‚é‹¼éµã€æ™¶ç‰‡ã€ç¨€åœŸï¼Œé€™äº›å¯¦é«”è³‡æºçš„é–‹æŽ¡èˆ‡åŠ å·¥å°‡æˆç‚ºæ–°çš„æˆ°ç•¥åˆ¶é«˜é»žã€‚"),
            html.Li("è¨ˆç®—è³‡æºï¼ˆComputational Resourcesï¼‰ï¼šè³‡æ–™ä¸­å¿ƒçš„é‹ç®—åŠ›ã€å„²å­˜å®¹é‡èˆ‡ç¶²è·¯é »å¯¬å°‡ç›´æŽ¥å½±éŸ¿ç”Ÿç”¢èˆ‡å‰µæ–°çš„ä¸Šé™ã€‚")
        ]),
        html.P(
            "åœ¨é€™å€‹æ–°ä¸–ç•Œä¸­ï¼Œä¸€åœ‹çš„ç¹æ¦®ä¸å†å–æ±ºæ–¼äººå£çš„å°±æ¥­çŽ‡ï¼Œè€Œæ˜¯èƒ½æºç¶²çµ¡çš„éŸŒæ€§ã€è³‡æºç²å–çš„èƒ½åŠ›ã€ä»¥åŠè¨ˆç®—åŸºç¤Žè¨­æ–½çš„è¦æ¨¡èˆ‡æ•ˆçŽ‡ã€‚"
        ),

        html.H5("çµè«–ï¼šå¿…é ˆé‡æ–°æå‡ºçš„å•é¡Œ"),
        html.P(
            "ç•¶ AGI èƒ½å¤ æ»¿è¶³äººé¡žæ‰€æœ‰ç‰©è³ªèˆ‡å¤§éƒ¨åˆ†ç²¾ç¥žéœ€æ±‚æ™‚ï¼Œç¶“æ¿Ÿå­¸çš„æ ¸å¿ƒå°‡å¾žã€Œå¦‚ä½•è³ºéŒ¢ç¶­æŒç”Ÿè¨ˆã€è½‰å‘ã€Œå¦‚ä½•åˆ†é…èˆ‡ä½¿ç”¨ç„¡é™çš„ç”Ÿç”¢åŠ›ã€ã€‚"
            "é€™å°‡å¼•ç™¼ä¸€ç³»åˆ—å‰æ‰€æœªæœ‰çš„å•é¡Œï¼š"
            "æˆ‘å€‘å¦‚ä½•ç¢ºä¿è²¡å¯Œçš„å…¬å¹³åˆ†é…ï¼Ÿ"
            "äººé¡žåœ¨åƒ¹å€¼å‰µé€ ä¸­çš„è§’è‰²æ˜¯ä»€éº¼ï¼Ÿ"
            "ã€Œå·¥ä½œã€èˆ‡ã€Œä¼‘é–’ã€çš„ç•Œç·šåˆè©²å¦‚ä½•é‡æ–°ç•Œå®šï¼Ÿ"
        ),
        html.P(
            "20 ä¸–ç´€çš„ç¶“æ¿Ÿå­¸é—œæ³¨å¦‚ä½•é€éŽå°±æ¥­ä¾†å…‹æœå€‹äººçš„åŒ±ä¹ï¼›"
            "21 ä¸–ç´€åŠä»¥å¾Œçš„ç¶“æ¿Ÿå­¸å°‡é—œæ³¨å¦‚ä½•å»ºç«‹èƒ½åœ¨è±é¥’æ™‚ä»£æŒçºŒç¹æ¦®çš„äººé¡žç¤¾æœƒã€‚"
            "æ­¡è¿Žä¾†åˆ°ç¶“æ¿Ÿå­¸ 101 â€”â€” æœªä¾†å·²ç„¶å±•é–‹ã€‚"
        )  
    ]

def chapter2_content():
    return [
        html.H4("ðŸ“– ç¬¬2ç« ï¼šèƒ½æºãƒ»ææ–™ãƒ»è¨ˆç®—â€”â€”æ–°çš„ä¸‰å¤§ç¨€ç¼º"),
        html.P(
            "åœ¨å¾Œç¨€ç¼ºæ¡†æž¶ä¸‹ï¼Œé™åˆ¶ç¶“æ¿Ÿå¢žé•·çš„ä¸å†æ˜¯äººåŠ›ï¼Œè€Œæ˜¯èƒ½æºã€ææ–™èˆ‡è¨ˆç®—ä¸‰è€…çš„è€¦åˆç“¶é ¸ã€‚"
            "æœ¬ç« å¾žæŠ€è¡“â€”åˆ¶åº¦â€”åœ°ç·£æ”¿æ²»ä¸‰å€‹ç¶­åº¦ï¼Œè§£æžé€™ä¸‰å¤§ç¨€ç¼ºå¦‚ä½•æ§‹æˆæ–°çš„å®è§€ç´„æŸã€‚"
        ),
        html.H5("ä¸€ã€èƒ½æºï¼šå¾žæˆæœ¬åˆ°é«”ç³»éŸŒæ€§"),
        html.P(
            "èƒ½æºä¸åƒ…æ˜¯æˆæœ¬ï¼Œæ›´æ˜¯ã€Œå¯ç”¨æ€§ Ã— ç©©å®šæ€§ Ã— æ½”æ·¨åº¦ã€çš„å‘é‡ã€‚ç•¶æ™ºèƒ½èˆ‡è‡ªå‹•åŒ–æ»²é€å¯¦é«”ç¶“æ¿Ÿï¼Œ"
            "è² è¼‰æ›²ç·šæ›´å°–éŠ³ï¼Œå°–å³°ä¾›çµ¦èˆ‡å„²èƒ½èª¿åº¦æˆç‚ºæ ¸å¿ƒå·¥ç¨‹å•é¡Œã€‚"
            "åœ‹å®¶ç«¶çˆ­åŠ›å°‡å–æ±ºæ–¼ä½Žé‚Šéš›æˆæœ¬èƒ½æºèˆ‡é«˜å½ˆæ€§é›»ç¶²çš„çµ„åˆã€‚"
        ),
        html.H5("äºŒã€ææ–™ï¼šç‰©ç†ä¸–ç•Œçš„åŸºç¤Žæ‘©æ“¦"),
        html.P(
            "åŽŸææ–™çš„ç¨€ç¼ºæºè‡ªåœ°è³ªåˆ†å¸ƒã€æç…‰é›£åº¦èˆ‡åœ°ç·£é¢¨éšªã€‚å³ä¾¿è¨­è¨ˆèˆ‡è»Ÿé«”å¯çž¬é–“è¤‡è£½ï¼Œ"
            "ç‰©è³ªä¸–ç•Œä»éœ€æ™‚é–“èˆ‡ç‰©æµï¼›å¾ªç’°ææ–™å­¸èˆ‡è¿‘æºè£½é€ å°‡æˆç‚ºä¾›æ‡‰éˆéŸŒæ€§çš„é—œéµæ§“æ¡¿ã€‚"
        ),
        html.H5("ä¸‰ã€è¨ˆç®—ï¼šç®—åŠ›çµæ§‹èˆ‡æ¼”ç®—æ³•æ•ˆçŽ‡"),
        html.P(
            "ç®—åŠ›ä¸åƒ…æ˜¯ GPU æ•¸é‡ï¼Œæ›´æ¶‰åŠè¨˜æ†¶é«”é »å¯¬ã€äº’é€£æ‹“æ’²ã€è³‡æ–™åœ¨åœ°æ€§èˆ‡è»Ÿç¡¬å”åŒã€‚"
            "åœ¨ç›¸åŒç¡¬é«”æ¢ä»¶ä¸‹ï¼Œæ¼”ç®—æ³•æ•ˆçŽ‡å¯å¸¶ä¾†æ•¸é‡ç´šçš„èƒ½è€—èˆ‡æˆæœ¬å·®ç•°ï¼Œ"
            "æˆç‚ºä¼æ¥­é‚Šéš›ç«¶çˆ­åŠ›çš„éš±å½¢åˆ†æ°´å¶ºã€‚"
        ),
        html.H5("çµèªžï¼šä¸‰è€…å”åŒçš„æ”¿ç­–èˆ‡æ²»ç†"),
        html.P(
            "èƒ½æºã€ææ–™èˆ‡è¨ˆç®—äº’ç‚ºé‚Šç•Œæ¢ä»¶ï¼šèƒ½æºæ“´å¼µè³¦èƒ½ç®—åŠ›èˆ‡ææ–™æç…‰ï¼›"
            "ææ–™å‰µæ–°åéŽä¾†é™ä½Žèƒ½æºâ€”ç®—åŠ›å–®ä½æˆæœ¬ï¼›è¨ˆç®—å„ªåŒ–åˆæå‡èƒ½æºèˆ‡ææ–™é…ç½®æ•ˆçŽ‡ã€‚"
            "èƒ½åœ¨ä¸‰è€…é–“é”æˆè·¨åŸŸå”åŒèˆ‡é•·æœŸä¸»æ¬Šä¿éšœçš„ç¶“æ¿Ÿé«”ï¼Œå°‡åœ¨å¾Œç¨€ç¼ºæ™‚ä»£æ‹”å¾—é ­ç±Œã€‚"
        ),
    ]
def chapter3_content():
    return [
        html.H4("ðŸ“– ç¬¬3ç« ï¼šåˆ†é…ã€æ‰€æœ‰æ¬Šèˆ‡æ¿€å‹µâ€”â€”å¾Œç¨€ç¼ºæ™‚ä»£çš„åˆ¶åº¦è¨­è¨ˆ"),
        html.P(
            "å‰å…©ç« æŒ‡å‡ºï¼šç•¶å¯è¤‡è£½çš„æ™ºèƒ½ä½¿å‹žå‹•ä¸å†ç¨€ç¼ºï¼Œç¶“æ¿Ÿçš„ç“¶é ¸è½‰å‘èƒ½æºã€ææ–™èˆ‡è¨ˆç®—ã€‚"
            "ç„¶è€Œï¼Œç”Ÿç”¢åŠ›çš„å¤–æ“´ä¸¦ä¸è‡ªå‹•ç­‰æ–¼ç¦ç¥‰çš„æå‡ï¼›åˆ¶åº¦å¦‚ä½•ç•Œå®šã€Œèª°æ“æœ‰ä»€éº¼ã€èª°ç²å¾—ä»€éº¼ã€"
            "ä»¥åŠäººå€‘ç‚ºä½•è€ŒåŠªåŠ›ã€ï¼Œå°‡æ±ºå®šå¾Œç¨€ç¼ºæ™‚ä»£çš„åˆ†é…çµæ§‹èˆ‡æ–‡æ˜Žèµ°å‘ã€‚"
        ),

        html.H5("ä¸€ã€åˆ†é…æ©Ÿåˆ¶ï¼šå¾žã€Žæ‰€å¾—ã€åˆ°ã€Žæ¬Šç›Šé…çµ¦ã€"),
        html.P(
            "ç•¶é‚Šéš›ç”Ÿç”¢ä¸»è¦ç”±æ©Ÿå™¨å®Œæˆï¼Œå‚³çµ±ä»¥å·¥è³‡ç‚ºæ ¸å¿ƒçš„åˆ†é…æ©Ÿåˆ¶å°‡å¤±åŽ»éŒ¨é»žã€‚"
            "åˆ†é…é‚è¼¯éœ€å¾žã€Žæ‰€å¾—ã€è½‰å‘å°ç¨€ç¼ºè¦ç´ èˆ‡å…¬å…±ç”¢å‡ºçš„ã€Žæ¬Šç›Šé…çµ¦ã€ã€‚"
        ),
        html.Ul([
            html.Li("æ™®æƒ åˆ†ç´…ï¼ˆSocial Dividendï¼‰ï¼šä»¥ä¸»æ¬ŠåŸºé‡‘æˆ–å…¬å…±è³‡ç”¢ï¼ˆå¦‚èƒ½æºã€ç®—åŠ›ã€é »è­œã€åœŸåœ°æ”¶ç›Šï¼‰ç‚ºåº•ï¼Œå‘å…¨é«”å…¬æ°‘æŒ‰äººé ­ç™¼æ”¾åˆ†ç´…ã€‚"),
            html.Li("è³‡æ–™èˆ‡æ¨¡åž‹ç´…åˆ©ï¼ˆData / Model Dividendï¼‰ï¼šå€‹äººèˆ‡ç¤¾ç¾¤å°è³‡æ–™ã€æ¨™è¨»èˆ‡æƒ…å¢ƒè²¢ç»æœ‰æŒçºŒåˆ†äº«æ©Ÿåˆ¶ï¼Œé¿å…ã€Žé›¶åƒ¹æ ¼â€”é›¶è£œå„Ÿã€çš„å‰å¥ªã€‚"),
            html.Li("ç®—åŠ›èˆ‡èƒ½æºé…é¡ï¼ˆCompute / Energy Creditsï¼‰ï¼šå°ç¨€ç¼ºè¦ç´ ç™¼æ”¾å¯äº¤æ˜“é…é¡ï¼Œæ—¢ä¿éšœåŸºæœ¬ä½¿ç”¨æ¬Šï¼Œåˆè®“å¸‚å ´åœ¨é‚Šéš›ä¸Šé…ç½®æ•ˆçŽ‡ã€‚"),
            html.Li("å…¬å…±å“å›žè³¼ï¼ˆRetroactive Public Goods Fundingï¼‰ï¼šå°äº‹å¾Œè­‰æ˜Žé«˜ç¤¾æœƒåƒ¹å€¼çš„ç§‘ç ”èˆ‡é–‹æºé …ç›®çµ¦äºˆæº¯åŠæ€§çš„è²¡å‹™å›žå ±ï¼Œå½¢æˆé•·æœŸæ¿€å‹µã€‚"),
        ]),

        html.H5("äºŒã€æ‰€æœ‰æ¬Šï¼šå¾žæŽ’ä»–åˆ°å…±ç›Šçš„ç‰ˆåœ–é‡ç¹ª"),
        html.P(
            "åœ¨å¯è¤‡è£½çš„æ•¸ä½ä¸–ç•Œï¼Œå¼·æŽ’ä»–æ€§çš„æ‰€æœ‰æ¬Šå®¹æ˜“æŠ‘åˆ¶å¤–éƒ¨æ€§èˆ‡ç–Šä»£å‰µæ–°ï¼›"
            "è€Œå®Œå…¨ç„¡é‚Šç•Œçš„å…±äº«åˆå¯èƒ½ç”¢ç”Ÿã€Žå…¬åœ°æ‚²åŠ‡ã€ã€‚"
            "å¾Œç¨€ç¼ºæ²»ç†éœ€åœ¨å…©è€…é–“æ‰¾åˆ°å¯æ¼”åŒ–çš„ä¸­é–“æ…‹ã€‚"
        ),
        html.Ul([
            html.Li("æ¨¡çµ„åŒ–æ¬Šåˆ©æŸï¼ˆBundle of Rightsï¼‰ï¼šå°‡ã€Žä½¿ç”¨ã€æ”¶ç›Šã€æ”¹ä½œã€åˆ†ç™¼ã€æ‹†åˆ†ï¼Œé‡å°æ¨¡åž‹æ¬Šé‡ã€è³‡æ–™èªžæ–™ã€æç¤ºå·¥ç¨‹å„è‡ªåˆ¶å®šç´°åˆ†æ¬Šåˆ©ã€‚"),
            html.Li("å…±äº«â€”å•†ç”¨é›™è»Œï¼ˆDual Licensingï¼‰ï¼šåŸºç¤Žæ¨¡åž‹èˆ‡è³‡æ–™é›†ä»¥é–‹æºã€éžå•†ç”¨æˆ–æ¢æ¬¾é™åˆ¶é‡‹å‡ºï¼Œå•†æ¥­åŒ–å‰‡æŽ¡å–åˆç†æŽˆæ¬Šè²»èˆ‡åˆ†æ½¤ã€‚"),
            html.Li("ç¤¾ç¾¤æ²»ç†èˆ‡æ†²ç« ï¼ˆCommunity Charterï¼‰ï¼šç”±å¤šæ–¹ç¯€é»žå…±åŒç¶­è­·æ¨¡åž‹èˆ‡è³‡æ–™æ²»ç†æº–å‰‡ï¼Œé€éŽæŠ•ç¥¨èˆ‡å¯©è¨ˆç¶­æŒé‚Šç•Œèˆ‡å“è³ªã€‚"),
            html.Li("ä¸»æ¬Šç®—åŠ›èˆ‡è³‡æ–™æ‰˜ç®¡ï¼ˆSovereign Compute/Dataï¼‰ï¼šåœ¨è·¨åœ‹ä¾›æ‡‰éˆé¢¨éšªä¸‹ï¼Œé—œéµç®—åŠ›èˆ‡è³‡æ–™æŽ¡åŽ»ä¸­å¿ƒè€Œå¯å¯©è¨ˆçš„ä¸»æ¬Šæ‰˜ç®¡æž¶æ§‹ã€‚"),
        ]),

        html.H5("ä¸‰ã€æ¿€å‹µè¨­è¨ˆï¼šè®“å‰µæ–°èˆ‡å…¬ç›ŠåŒå‘"),
        html.P(
            "ç•¶ã€Žå·¥ä½œï¼æ”¶å…¥ã€é¬†å‹•ï¼Œæ¿€å‹µä¾¿éœ€å›žåˆ°ç›®çš„æœ¬èº«ï¼šè¿½æ±‚çœŸç†ã€å‰µé€ ç¾Žã€ç…§è­·ä»–äººã€ä¿è­·ç’°å¢ƒã€"
            "æŽ¨é€²åˆ¶åº¦å“è³ªã€‚æ©Ÿåˆ¶è¨­è¨ˆçš„æ ¸å¿ƒï¼Œæ˜¯è®“å€‹é«”è¿½æ±‚è‡ªåˆ©æ™‚ä¹Ÿèƒ½æ“´å¤§å…¬å…±åƒ¹å€¼ã€‚"
        ),
        html.Ul([
            html.Li("çŽé‡‘åˆ¶èˆ‡æŒ‘æˆ°è³½ï¼ˆPrize Mechanismsï¼‰ï¼šä»¥æ˜Žç¢ºç›®æ¨™èˆ‡å¯é©—è­‰æŒ‡æ¨™ä¾†å¼•å°Žç ”ç™¼ï¼Œé¿å…ã€Žè£œåŠ©â€”æŒ‡æ¨™æ‰­æ›²ã€ã€‚"),
            html.Li("äºŒæ¬¡æ–¹è³‡åŠ©ï¼ˆQuadratic Fundingï¼‰ï¼šä»¥å°é¡å¤šæ•¸åå¥½åŠ æ¬Šï¼Œé¼“å‹µåˆ†æ•£å¼å‰µæ–°èˆ‡ç¤¾ç¾¤å„ªå…ˆè­°é¡Œã€‚"),
            html.Li("å½±å­åƒ¹æ ¼èˆ‡å¤–éƒ¨æ€§ç¨…ï¼ˆPigouvian Toolsï¼‰ï¼šå°ç¢³ã€è³‡å®‰é¢¨éšªã€å°é½Šå¤±èª¤ç­‰å¤–éƒ¨æ€§è³¦äºˆåƒ¹æ ¼ï¼Œä»¥å¸‚å ´æ–¹å¼å…§ç”ŸåŒ–æ²»ç†ã€‚"),
            html.Li("å¯é©—è­‰æ†‘è­‰ï¼ˆVerifiable Credentialsï¼‰ï¼šæŠŠè²¢ç»èˆ‡è²è­½è½‰ç‚ºå¯æ”œå¸¶ã€å¯å¯©æ ¸çš„è³‡ç”¢ï¼Œé™ä½Žå”ä½œä¸­çš„é€†å‘é¸æ“‡èˆ‡é“å¾·é¢¨éšªã€‚"),
        ]),

        html.H5("å››ã€è²¨å¹£èˆ‡è²¡æ”¿ï¼šåœ¨è±é¥’ä¸­æ ¡æº–åƒ¹æ ¼è¨Šè™Ÿ"),
        html.P(
            "å¾Œç¨€ç¼ºä¸¦ä¸æ„å‘³åƒ¹æ ¼æ¶ˆå¤±ï¼›åƒ¹æ ¼æ‡‰å¾žåæ˜ ã€ŽäººåŠ›æˆæœ¬ã€è½‰å‘åæ˜ ã€Žå¯¦é«”ç“¶é ¸èˆ‡é¢¨éšªæº¢åƒ¹ã€ã€‚"
            "å®è§€æ”¿ç­–è¦å‹™ï¼Œæ˜¯ç©©å®šé—œéµç¨€ç¼ºè¦ç´ çš„æŠ•è³‡ç¯€å¥èˆ‡æœŸæœ›ã€‚"
        ),
        html.Ul([
            html.Li("æŠ—æ³¢å‹•çš„æŠ•è³‡è¦å‰‡ï¼šå°é›»ç¶²ã€å„²èƒ½ã€é—œéµææ–™èˆ‡ç®—åŠ›çš„é•·é€±æœŸä¿åº•æ©Ÿåˆ¶ï¼Œå¹³æ»‘æ™¯æ°£å¾ªç’°èˆ‡æŠ€è¡“è¿­ä»£çš„ä¸ç¢ºå®šã€‚"),
            html.Li("é€šç¸®â€”é€šè†¨çš„çµæ§‹ç–ŠåŠ ï¼šå¯è¤‡è£½å“é•·æœŸé€šç¸®ï¼Œå¯¦é«”ç¨€ç¼ºå“å¯èƒ½é€šè†¨ï¼›æŒ‡æ¨™é«”ç³»éœ€å€éš”ã€Žæ•¸ä½åƒ¹æ ¼ç±ƒã€èˆ‡ã€Žå¯¦é«”åƒ¹æ ¼ç±ƒã€ã€‚"),
            html.Li("ä¸»æ¬ŠåŸºé‡‘èˆ‡ä»£éš›å…¬å¹³ï¼šæŠŠè³‡æºæ”¶ç›Šè½‰ç‚ºå¯æ°¸çºŒåˆ†é…çš„é‡‘èžè³‡ç”¢ï¼Œé¿å…ä¸€æ¬¡æ€§æ¶ˆè²»èˆ‡ä»£éš›ä¸å…¬ã€‚"),
        ]),

        html.H5("äº”ã€é¢¨éšªèˆ‡è­·æ¬„ï¼šæŠŠå¤±éˆéŽ–åœ¨ç³»çµ±å¤–"),
        html.P(
            "ç³»çµ±é¢¨éšªä¾†æºåŒ…æ‹¬ï¼šæ¨¡åž‹å°é½Šå¤±æ•—ã€æ¿«ç”¨èˆ‡æ“´æ•£ã€ä¾›æ‡‰éˆå–®é»žè„†å¼±ã€ä»¥åŠã€Žé»‘ç®±æ±ºç­–ã€ã€‚"
            "æ²»ç†éœ€è¦å¯è§€æ¸¬ã€å¯è¿½æº¯ã€å¯çµ‚æ­¢çš„æŠ€è¡“èˆ‡æ³•åˆ¶çµ„åˆã€‚"
        ),
        html.Ul([
            html.Li("åˆ†ç´šä½¿ç”¨èˆ‡æ²™ç›’ï¼šä¾èƒ½åŠ›èˆ‡é¢¨éšªåˆ†ç´šå‡†å…¥ï¼›é«˜é¢¨éšªæ‡‰ç”¨é ˆåœ¨å¯©è¨ˆæ²™ç›’ä¸­é‹è¡Œä¸¦ç•™å­˜æ—¥èªŒã€‚"),
            html.Li("è¨ˆç®—åŸ·ç…§èˆ‡å®‰å…¨åŸºç·šï¼šå¤§åž‹è¨“ç·´éœ€ç”³å ±è³‡æ–™ä¾†æºã€èƒ½è€—èˆ‡è©•æ¸¬çµæžœï¼Œé”åˆ°æœ€ä½Žå®‰å…¨åŸºç·šæ–¹å¯éƒ¨ç½²ã€‚"),
            html.Li("å¯è¿½è²¬çš„ä»£ç†éˆï¼šå°è‡ªæ²»ä»£ç†çš„è¡Œç‚ºå»ºç«‹ç°½åèˆ‡å¯é©—è­‰æº¯æºï¼Œè½å¯¦ã€Žèª°éƒ¨ç½²ã€èª°è² è²¬ã€ã€‚"),
            html.Li("å¤±æ•ˆå®‰å…¨ï¼ˆFail-safeï¼‰èˆ‡æ–·è·¯å™¨ï¼šåœ¨ç•°å¸¸è¼¸å‡ºèˆ‡è¡Œç‚ºåµæ¸¬åˆ°ä½æ™‚ï¼Œèƒ½å¿«é€Ÿé™ç´šèˆ‡éš”é›¢ã€‚"),
        ]),

        html.H5("å…­ã€éŽæ¸¡è·¯å¾‘ï¼šå¾žç•¶ä¸‹èµ°å‘å¾Œç¨€ç¼º"),
        html.P(
            "åˆ¶åº¦çš„å¯è¡Œæ€§å–æ±ºæ–¼éŽæ¸¡æˆæœ¬ã€‚æ”¿ç­–è¨­è¨ˆéœ€é¿å…ã€Žä¸€åˆ€åˆ‡ã€ï¼Œä»¥åºåˆ—åŒ–ã€å¯å›žé€€çš„æ–¹å¼æŽ¨é€²ã€‚"
        ),
        html.Ul([
            html.Li("é›™è¿´è·¯ç­–ç•¥ï¼šåœ¨ç¾è¡Œå·¥è³‡é«”ç³»ä¸Šç–ŠåŠ æ¬Šç›Šé…çµ¦è©¦é»žï¼Œé€æ­¥æé«˜å…¬å…±åˆ†ç´…èˆ‡é…é¡æ¯”é‡ã€‚"),
            html.Li("æŠ€èƒ½è½‰æ›èˆ‡èº«ä»½ä¿éšœï¼šæä¾›é•·å¹´é™å†è¨“ç·´ã€è·æ¶¯è½‰è»Œä¿éšªèˆ‡å‰µæ¥­æ”¯æŒï¼Œé™ä½Žè½‰åž‹æ‘©æ“¦ã€‚"),
            html.Li("åœ°æ–¹è©¦é»žâ€”è¯é‚¦æ“´æ•£ï¼šå…ˆåœ¨èƒ½æºå……è£•ã€æ•¸æ“šæ²»ç†æˆç†Ÿçš„åœ°å€è©¦è¡Œï¼Œå½¢æˆæ¨™æº–å¾Œå†å…¨åŸŸæŽ¨å»£ã€‚"),
        ]),

        html.H5("çµèªžï¼šæŠŠæ–‡æ˜Žç›®æ¨™å…§åµŒé€²ç¶“æ¿Ÿæ©Ÿåˆ¶"),
        html.P(
            "å¾Œç¨€ç¼ºä¸æ˜¯ã€Žæ²’æœ‰é¸æ“‡çš„çƒæ‰˜é‚¦ã€ï¼Œè€Œæ˜¯ã€Žéœ€è¦æ›´å¥½é¸æ“‡çš„ç¾å¯¦ã€ã€‚"
            "åˆ†é…ã€æ‰€æœ‰æ¬Šèˆ‡æ¿€å‹µçš„è¨­è¨ˆï¼Œå¿…é ˆæŠŠæ–‡æ˜Žç›®æ¨™â€”â€”çœŸç†ã€å–„æ„ã€è‡ªç”±èˆ‡ç¾Žâ€”â€”"
            "å…§åµŒç‚ºå¯é‹è¡Œã€å¯å¯©è¨ˆã€å¯æ¼”åŒ–çš„åˆ¶åº¦ç¨‹å¼ã€‚"
            "ç•¶åˆ¶åº¦èƒ½è®“å€‹é«”çš„è¿½æ±‚è‡ªç„¶åŒ¯èšç‚ºå…¬å…±åƒ¹å€¼ï¼Œå¾Œç¨€ç¼ºæ‰å¯èƒ½æˆç‚ºå¾ŒåŒ±ä¹çš„äººé¡žç¤¾æœƒã€‚"
        ),
    ]

app.layout = html.Div([
    html.H1("Rule of 40"),

    rule_header,

    # Controls: height slider + label + next chapter button
    html.Div([
        html.Div([
            html.Label("é–±è®€æ¡†é«˜åº¦ï¼ˆpxï¼‰", style={"fontWeight": "600"}),
            dcc.Slider(
                id="height-slider",
                min=300, max=1000, step=50, value=600,
                marks={300: "300", 600: "600", 900: "900", 1000: "1000"},
                tooltip={"placement": "bottom", "always_visible": False},
            ),
            html.Div(id="height-label", style={"marginTop": "0.5rem", "fontSize": "0.9rem", "opacity": 0.8}),
        ], style={"flex": "1"}),

    html.Div([
        html.Button("ä¸‹ä¸€ç«  Next chapter â†’", id="next-btn",
                    style={
                        "padding": "10px 16px",
                        "borderRadius": "10px",
                        "border": "1px solid #ddd",
                        "cursor": "pointer",
                        "background": "white",
                        "boxShadow": "0 1px 4px rgba(0,0,0,0.08)",
                        "fontWeight": 600
                    })
        ], style={"display": "flex", "alignItems": "flex-end", "paddingLeft": "1rem"})
    ], style={"display": "flex", "gap": "1.5rem", "marginBottom": "1rem"}),

    dcc.Store(id="chapter-index", data=0),

    # Scrollable chapter box (height controlled by slider)
    html.Div(
        id="chapter-box",
        children=[
            html.Div(id="chapter-content", children=chapter1_content())
        ],
        style={
            'width': '90%',
            'float': 'left',
            "padding": "1em",
            "border": "1px solid #ccc",
            "borderRadius": "10px",
            "backgroundColor": "#222222",
            "maxHeight": "600px",   # will be updated by slider
            "overflowY": "auto"     # scroller
        }),
    

    
    html.Div([
        html.Label("Company Ticker Label:   "),
        dcc.Input(id='input-label', type='text', placeholder='e.g. NVDA'),
        html.Button('Add Company', id='submit-button', n_clicks=0),
        html.H1(""),
        html.Label("Adjusted Operating Margin (%):   "),
        dcc.Input(id='input-margin', type='number', step=0.01),
        html.H1(""),
        html.Label("YoY Revenue Growth (%):   "),
        dcc.Input(id='input-growth', type='number', step=0.01),
        html.H1(""),
        html.Label("Market Cap (Billion):  "),
        dcc.Input(id='input-market-cap', type='number', step=0.01)
    ], style={'width': '30%',
        'float': 'left',
        'margin': '20px',
        'padding': '20px',
        'fontSize': '16px'}),

    html.Div([
        dcc.Store(id='company-data', data=initial_data),
        dcc.Graph(id='scatter-plot')
    ], style={
        'width': '68%',
        'float': 'left'
    })

], style={ "margin": "0 auto", "padding": "1rem"})

@app.callback(
    Output("chapter-box", "style"),
    Output("height-label", "children"),
    Input("height-slider", "value"),
    State("chapter-box", "style"),
)
def update_box_height(px, style):
    """Adjust the scroll-box height and show current value."""
    style = dict(style or {})
    style["maxHeight"] = f"{px}px"
    style["overflowY"] = "auto"  # force scroller when overflow
    return style, f"ç›®å‰é«˜åº¦ï¼š{px}px"

@app.callback(
    Output("chapter-content", "children"),
    Output("chapter-index", "data"),
    Input("next-btn", "n_clicks"),
    State("chapter-index", "data"),
)

def next_chapter(n, idx):
    """Cycle chapters when button is clicked."""
    idx = (idx or 0)
    if not n:
        # initial render
        return chapter1_content(), idx
    new_idx = (idx + 1) % 3
    if new_idx == 0:
        return chapter1_content(), new_idx
    elif new_idx == 1:
        return chapter2_content(), new_idx
    elif new_idx == 2:
        return chapter3_content(), new_idx
    else :
        return chapter1_content(), new_idx

@app.callback(
    Output('company-data', 'data'),
    Input('submit-button', 'n_clicks'),
    State('input-label', 'value'),
    State('input-margin', 'value'),
    State('input-growth', 'value'),
    State('input-market-cap', 'value'),
    State('company-data', 'data'),
)

def update_data(n_clicks, label, margin, growth, cap, data):
    if n_clicks > 0 and label and margin is not None and growth is not None:
        data.append((label, margin, growth, cap))
    return data

@app.callback(
    Output('scatter-plot', 'figure'),
    Input('company-data', 'data')
)

def update_plot(data):
    labels, margins, growths, caps = zip(*data)
    intercept_line = 40 #

    # Regression line
    x_line = list(range(0, int(max(margins)) + 5))
    y_line = [slope * x + intercept_line for x in x_line]

    intercepts = [y - slope * x for x, y in zip(margins, growths)]
    hover_texts = [
        f"{label}<br>Margin: {x:.2f}%<br>Growth: {y:.2f}%<br>Market Cap: {c:.2f}B<br>Intercept: {b:.2f}"
        for label, x, y, c, b in zip(labels, margins, growths, caps, intercepts)
    ]
    scatter = go.Scatter(
        x=margins,
        y=growths,
        mode='markers+text',
        text=labels,
        hovertext=hover_texts,
        textposition='top center',
        marker=dict(
            size=caps,
            sizemode='area',
            sizeref=2.*max(caps)/(80.**2),  # adjust for visual scaling
            sizemin=5,
            color='cyan'
        ), # Changed marker color for dark mode visibility
        name='Companies'
    )

    line = go.Scatter(
        x=x_line,
        y=y_line,
        mode='lines',
        name='Rule of 40 Frontier',
        line=dict(color='red', dash='dash')
    )

    layout = go.Layout(
        xaxis=dict(
            title='Adjusted Operating Margin (%)',
            range = [0,75],
            dtick=10,
            gridcolor='#444444', # Darker grid lines
            zerolinecolor='#666666',
            tickfont=dict(color='#f0f0f0'), # Light tick labels
            title_font=dict(color='#f0f0f0') # Light title font
        ),
        yaxis=dict(
            title='YoY Revenue Growth (%)',
            range=[0, 145],
            dtick=10,
            gridcolor='#444444', # Darker grid lines
            zerolinecolor='#666666',
            tickfont=dict(color='#f0f0f0'), # Light tick labels
            title_font=dict(color='#f0f0f0'), # Light title font
        ),
        showlegend=True,
        width=1600,
        height=600,

        plot_bgcolor='#333333', # Dark background for the plot area
        paper_bgcolor='#222222', # Dark background for the entire figure
        font=dict(color='#f0f0f0') # Default font color for the graph
    
    )




    return go.Figure(data=[scatter, line], layout=layout)





if __name__ == '__main__':
    app.run(debug=True)
